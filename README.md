# Four Digit Bot

–¢–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç –≤—ã–¥–∞—ë—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ 4-–∑–Ω–∞—á–Ω—ã–µ –∫–æ–¥—ã (0000‚Äì9999) –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–æ–≤. –ï—Å—Ç—å –∏–º–ø–æ—Ä—Ç/—ç–∫—Å–ø–æ—Ä—Ç —Å–ø–∏—Å–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–¥–æ–≤, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç –ø–µ—Ä–µ–¥ –æ—á–∏—Å—Ç–∫–æ–π –∏ whitelist –ø–æ user_id.

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1) –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (uv):
```bash
uv sync
```
2) –°–æ–∑–¥–∞–π—Ç–µ `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–º–µ—Ä–∞:
```bash
cp .env.example .env
```
3) –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ (–∫–æ—Ä–æ—Ç–∫–∞—è –∫–æ–º–∞–Ω–¥–∞ –∏–∑ `project.scripts`):
```bash
uv run four-digit-bot
```
   –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ —Ç–µ–º –∂–µ –ø—É—Ç—ë–º:
```bash
uv run src/four_digit_bot/main.py
```

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (`.env`)
- `BOT_TOKEN` ‚Äî —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –æ—Ç BotFather.
- `ALLOWED_USER_IDS` ‚Äî —Å–ø–∏—Å–æ–∫ Telegram user_id —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é, –∫—Ç–æ –º–æ–∂–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–æ—Ç–æ–º. –ü—Ä–∏–º–µ—Ä: `12345,67890`.
- `DATABASE_PATH` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚Äî –ø—É—Ç—å –∫ SQLite –±–∞–∑–µ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `data/state.db`.
- `WINNING_CODES` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 88) ‚Äî —Å–∫–æ–ª—å–∫–æ ¬´—Ü–µ–ª–µ–≤—ã—Ö¬ª –∫–æ–¥–æ–≤ —Å—á–∏—Ç–∞—Ç—å –≤—ã–∏–≥—Ä—ã—à–Ω—ã–º–∏ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏.
- `TOTAL_CODES` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10000) ‚Äî –æ–±—â–∏–π —Ä–∞–∑–º–µ—Ä –ø—É–ª–∞ –∫–æ–¥–æ–≤.

## –ö–æ–º–∞–Ω–¥—ã –∏ –∫–Ω–æ–ø–∫–∏
- `/start` ‚Äî –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞.
- `/code` –∏–ª–∏ –∫–Ω–æ–ø–∫–∞ ¬´üî¢ –ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥¬ª ‚Äî –≤—ã–¥–∞—ë—Ç –Ω–æ–≤—ã–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥.
- `/export` –∏–ª–∏ ¬´üì§ –≠–∫—Å–ø–æ—Ä—Ç¬ª ‚Äî txt —Å —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–º–∏ –∫–æ–¥–∞–º–∏.
- `/import` –∏–ª–∏ ¬´üì• –ò–º–ø–æ—Ä—Ç¬ª ‚Äî –±–æ—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç txt, –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–º–µ—á–∞–µ—Ç –∫–æ–¥—ã –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ.
- `/clear` –∏–ª–∏ ¬´üßπ –û—á–∏—Å—Ç–∏—Ç—å¬ª ‚Äî —Å–Ω–∞—á–∞–ª–∞ —ç–∫—Å–ø–æ—Ä—Ç, –∑–∞—Ç–µ–º –∑–∞–ø—Ä–æ—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏ –æ—á–∏—Å—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö.
- `/remaining` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å, —Å–∫–æ–ª—å–∫–æ –∫–æ–¥–æ–≤ –æ—Å—Ç–∞–ª–æ—Å—å.

## –§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–æ–≤
`codes.txt` ‚Äî –ø–æ –æ–¥–Ω–æ–º—É –∫–æ–¥—É –≤ —Å—Ç—Ä–æ–∫–µ, 4 —Ü–∏—Ñ—Ä—ã —Å –≤–µ–¥—É—â–∏–º–∏ –Ω—É–ª—è–º–∏. –õ–∏—à–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏/–¥—É–±–ª–∏–∫–∞—Ç—ã –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è, –Ω–µ–≤–µ—Ä–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- `config.py` ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–∑ env.
- `db.py` ‚Äî SQLite + –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—É–ª–∞ –∫–æ–¥–æ–≤, –∞—Ç–æ–º–∞—Ä–Ω–∞—è –≤—ã–¥–∞—á–∞ –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–æ–≤.
- `services.py` ‚Äî –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (–∏–º–ø–æ—Ä—Ç/—ç–∫—Å–ø–æ—Ä—Ç/–æ—á–∏—Å—Ç–∫–∞).
- `middleware.py` ‚Äî whitelist –ø–æ user_id.
- `keyboards.py` ‚Äî –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã.
- `main.py` ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ö—ç–Ω–¥–ª–µ—Ä–æ–≤ `aiogram 3` –∏ –∑–∞–ø—É—Å–∫.

## –î–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä (systemd)
1) –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–æ–µ–∫—Ç, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Python 3.12+ –∏ uv.
2) –°–æ–∑–¥–∞–π—Ç–µ `/etc/systemd/system/four-digit-bot.service`:
```
[Unit]
Description=Four digit telegram bot
After=network.target

[Service]
WorkingDirectory=/path/to/four-digit-bot
EnvironmentFile=/path/to/four-digit-bot/.env
ExecStart=/usr/bin/env uv run src/four_digit_bot/main.py
Restart=on-failure
User=youruser
Group=youruser

[Install]
WantedBy=multi-user.target
```
3) `sudo systemctl daemon-reload && sudo systemctl enable --now four-digit-bot`.

–õ–æ–≥–∏ –º–æ–∂–Ω–æ —Å–º–æ—Ç—Ä–µ—Ç—å —á–µ—Ä–µ–∑ `journalctl -u four-digit-bot -f`.

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è
- –ë–∞–∑–∞ –∏ WAL-—Ñ–∞–π–ª—ã –ª–µ–∂–∞—Ç –≤ `data/`, –¥–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
- –í—ã–¥–∞—á–∞ –∫–æ–¥–æ–≤ –∞—Ç–æ–º–∞—Ä–Ω–∞: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è UPDATE ... RETURNING –ø–æ–¥ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π, –≥–æ–Ω–æ–∫ –Ω–µ—Ç.
- –ò–º–ø–æ—Ä—Ç/—ç–∫—Å–ø–æ—Ä—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ–º whitelisted –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º.
